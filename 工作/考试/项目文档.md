# 在线考试系统 - 设计文档

## 项目概述

这是一个基于纯前端技术的在线考试系统，适用于企业内部培训考试、知识测验等场景。系统支持多种题型，具备完整的答题、评分、错题分析功能。

**技术栈**：HTML5 + CSS3 + 原生JavaScript（无外部依赖）

**适用场景**：
- 企业内部培训考试
- 知识竞赛
- 在线测评
- 学习效果检测

---

## 功能需求

### 1. 题型支持

系统支持以下4种题型：

| 题型 | 交互方式 | 评分规则 |
|------|---------|---------|
| **单选题** | 单选按钮（radio） | 完全正确得分 |
| **判断题** | 正确/错误单选 | 完全正确得分 |
| **多选题** | 复选框（checkbox），支持A-E共5个选项 | 完全正确得分 |
| **填空题** | 文本输入框 | 支持多个正确答案（逗号或竖线分隔）|

### 2. 核心功能

#### 2.1 答题功能
- ✅ 点击整个选项区域即可选中（提升用户体验）
- ✅ 选中的选项有明显视觉反馈（颜色变化、边框高亮）
- ✅ 已答题的题目卡片有视觉标记（蓝色边框）
- ✅ 实时保存答案到内存

#### 2.2 进度追踪
- ✅ 固定在顶部的进度条（滚动时始终可见）
- ✅ 实时显示已答题数量和百分比
- ✅ 题目卡片实时更新答题状态

#### 2.3 交卷评分
- ✅ 提交前检测未答题并提示
- ✅ 自动批改并计算总分
- ✅ 显示详细统计信息：
  - 总分
  - 正确率
  - 答对题数
  - 答错题数

#### 2.4 错题分析
- ✅ 答对的题目显示绿色边框
- ✅ 答错的题目显示红色边框
- ✅ 每道题显示答案解析：
  - 正确答案（绿色标注）
  - 你的答案（红色标注，仅答错时显示）
- ✅ "查看错题详情"按钮快速定位第一道错题

#### 2.5 重新考试
- ✅ 清空所有答案
- ✅ 重置进度条和题目状态
- ✅ 重置评分结果

### 3. 界面设计

#### 3.1 设计风格
- 现代化卡片式布局
- 紫色渐变背景（#667eea → #764ba2）
- 流畅的动画效果（滑入、淡入）
- 响应式设计，适配不同屏幕

#### 3.2 UI组件
- **题目卡片**：白色背景，阴影效果，hover时轻微上浮
- **进度条**：渐变色填充，实时更新百分比
- **按钮**：圆角按钮，hover时放大和阴影效果
- **选项**：边框样式，选中时背景色变化

---

## 技术要求

### 1. 技术限制
- ✅ 纯HTML + CSS + JavaScript实现
- ✅ 不使用localStorage（所有状态存储在内存）
- ✅ 不依赖任何外部库或框架
- ✅ 代码完整可运行，单文件即可使用

### 2. 浏览器兼容性
- Chrome 60+
- Firefox 60+
- Edge 79+
- Safari 12+

### 3. 性能要求
- 页面加载时间 < 1秒
- 答题交互响应时间 < 100ms
- 支持至少100道题目流畅运行

---

## 数据格式

### 题库数据格式（TSV格式）

```
题型	题干	难度	答案	选项A	选项B	选项C	选项D	选项E
单选题	问题内容		A	选项A内容	选项B内容	选项C内容	选项D内容
判断题	问题内容		正确
多选题	问题内容		ABDE	选项A内容	选项B内容	选项C内容	选项D内容	选项E内容
填空题	问题内容		答案1,答案2,答案3
```

**字段说明**：
- `题型`：单选题、判断题、多选题、填空题
- `题干`：题目内容
- `难度`：预留字段（暂未使用）
- `答案`：
  - 单选题：A/B/C/D
  - 判断题：正确/错误
  - 多选题：ABCDE（按字母顺序排列）
  - 填空题：答案1,答案2|答案3（支持逗号或竖线分隔多个正确答案）
- `选项A-E`：各选项内容（判断题和填空题不需要）

---

## 关键实现细节

### 1. 答案存储机制

```javascript
// 使用对象存储答案，key为题目id，value为答案
let userAnswers = {};

// 已答题：存在且value为真值
userAnswers[1] = 'A';        // 单选题
userAnswers[2] = '正确';      // 判断题
userAnswers[3] = 'BCD';      // 多选题
userAnswers[4] = 'KT2';      // 填空题

// 未答题：不存在key或value为falsy
delete userAnswers[5];       // 删除key表示未答题
```

**重要注意事项**：
- ❌ 不要使用 `null` 或空字符串 `''` 表示未答题
- ✅ 使用 `delete` 删除key来表示未答题
- 这样可以正确使用 `Object.keys(userAnswers).filter(id => userAnswers[id]).length` 统计已答题数

### 2. 事件处理机制

```javascript
// 避免重复触发的正确方式
function clickOption(questionId, option, type) {
    // 如果点击的是input或label，不处理（让原生事件处理）
    if (event.target.tagName === 'INPUT' || event.target.tagName === 'LABEL') {
        return;
    }

    const input = document.getElementById(`q${questionId}_${option}`);
    if (!input) return;

    if (type === 'radio') {
        input.checked = true;
        selectOption(questionId, option);
    } else if (type === 'checkbox') {
        input.checked = !input.checked;
        toggleMultiOption(questionId, option);
    }
}
```

**关键点**：
- div的onclick和input的onchange需要配合使用
- 点击input/label时只触发原生事件
- 点击div空白区域时通过JS触发

### 3. 多选题答案处理

```javascript
function toggleMultiOption(questionId, option) {
    const checkboxes = document.querySelectorAll(`input[name="q${questionId}"]:checked`);
    const selected = Array.from(checkboxes).map(cb => cb.value).sort().join('');

    if (selected) {
        userAnswers[questionId] = selected;  // 'ABC'
    } else {
        delete userAnswers[questionId];      // 全部取消选择
    }
}
```

**注意**：
- 多选答案必须按字母顺序排列：'ABC' 不是 'CBA'
- 使用 `.sort().join('')` 确保顺序一致

### 4. 填空题答案匹配

```javascript
// 支持多个正确答案
const correctAnswers = correctAnswer.split(/[,|]/).map(a => a.trim());
isCorrect = correctAnswers.some(ans =>
    userAnswer && userAnswer.toLowerCase() === ans.toLowerCase()
);
```

**支持格式**：
- 逗号分隔：`答案1,答案2,答案3`
- 竖线分隔：`答案1|答案2|答案3`
- 不区分大小写

### 5. 进度条固定实现

```css
.header {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: white;
    border-radius: 0 0 15px 15px;  /* 只有底部圆角 */
}
```

---

## 常见问题和解决方案

### 问题1: 已选中但提示未作答

**原因**：答案保存时使用了空字符串或null

**解决方案**：
```javascript
// ❌ 错误做法
userAnswers[id] = selected || null;
userAnswers[id] = value || '';

// ✅ 正确做法
if (selected) {
    userAnswers[id] = selected;
} else {
    delete userAnswers[id];
}
```

### 问题2: 点击选项卡顿或状态反转

**原因**：div的onclick和input的onchange重复触发

**解决方案**：
```javascript
// 在clickOption函数中判断点击目标
if (event.target.tagName === 'INPUT' || event.target.tagName === 'LABEL') {
    return;  // 让原生事件处理
}
```

### 问题3: 判断题无法选中

**原因**：id命名不一致
- HTML中：`id="q1_true"`
- JavaScript中：`getElementById('q1_正确')`

**解决方案**：
```javascript
// 统一使用中文
id="q${q.id}_正确"
id="q${q.id}_错误"
```

### 问题4: 多选题答案判定错误

**原因**：答案顺序不一致
- 正确答案：'ABC'
- 用户答案：'CBA'

**解决方案**：
```javascript
// 始终按字母顺序排列
const selected = Array.from(checkboxes)
    .map(cb => cb.value)
    .sort()
    .join('');
```

---

## 开发注意事项

### 1. ID命名规范

```javascript
// 题目卡片
id="question-${questionId}"

// 单选题/多选题选项
id="q${questionId}_${option}"  // q1_A, q1_B

// 判断题选项
id="q${questionId}_正确"
id="q${questionId}_错误"

// 填空题输入框
id="q${questionId}_input"

// 答案解析区域
id="analysis-${questionId}"
```

### 2. CSS类命名规范

```css
/* 状态类 */
.answered      /* 已答题 */
.selected      /* 选项已选中 */
.correct       /* 答对 */
.incorrect     /* 答错 */
.hidden        /* 隐藏 */

/* 样式类 */
.correct-answer   /* 正确答案样式（绿色） */
.wrong-answer     /* 错误答案样式（红色） */
.correct-mark     /* 正确标记 */
.wrong-mark       /* 错误标记 */
```

### 3. 数据解析注意事项

```javascript
// TSV数据使用制表符\t分隔
const cols = lines[i].split('\t');

// 解析时要检查列数
if (cols.length >= 4) {
    // 处理数据
}

// 选项可能为空，使用空字符串作为默认值
optionA: cols[4] || '',
optionB: cols[5] || '',
```

### 4. 性能优化建议

- 避免频繁的DOM操作，批量更新
- 使用事件委托处理大量选项点击
- 使用CSS动画代替JavaScript动画
- 合理使用防抖和节流

### 5. 用户体验优化

- 整个选项区域可点击（不只是radio/checkbox）
- 进度条固定在顶部，随时可见
- 提交前确认未答题情况
- 错题快速定位功能
- 动画效果流畅自然

---

## 调试技巧

### 1. 控制台调试

系统内置了详细的调试日志，打开控制台（F12）可查看：

```javascript
// 答题进度
console.log('已答题统计:', answeredCount, '/', totalCount);
console.log('userAnswers:', userAnswers);

// 提交时检查
console.log('❌ 未作答 - 题目ID (题型): 题干...');
console.log('✓ 已作答 - 题目ID (题型): 答案=XXX');
```

### 2. 常用调试代码

```javascript
// 查看所有答案
console.table(userAnswers);

// 查看某道题的状态
console.log(userAnswers[questionId]);

// 查看DOM元素
console.log(document.getElementById('q1_A'));

// 查看所有选中的多选框
console.log(document.querySelectorAll('input[name="q1"]:checked'));
```

---

## 扩展建议

### 可扩展功能

1. **计时功能**：添加考试倒计时
2. **题目乱序**：随机打乱题目顺序
3. **选项乱序**：随机打乱选项顺序
4. **分数权重**：不同题型不同分值
5. **难度系数**：根据难度调整分值
6. **答题记录**：导出答题记录到CSV
7. **成绩统计**：多次考试的成绩对比
8. **题库管理**：在线编辑题库
9. **分类筛选**：按题型、难度筛选
10. **收藏错题**：收藏功能，重点复习

### 技术升级方向

- 使用Vue/React重构，提升可维护性
- 引入状态管理（Vuex/Redux）
- 后端API集成，题库云端存储
- 移动端适配优化
- 打印成绩单功能
- PWA支持，离线使用

---

## 项目文件结构

```
考试系统/
├── 考试.md              # 题库数据（TSV格式）
├── 要求.md              # 原始需求文档
├── 考试系统.html        # 完整系统（单文件）
├── 项目文档.md          # 本文档
└── README.md            # 使用说明（可选）
```

---

## 快速开始

### 1. 准备题库数据

按照以下格式准备题库（TSV格式，使用制表符分隔）：

```
题型	题干	难度	答案	选项A	选项B	选项C	选项D	选项E
单选题	你的问题?		A	选项1	选项2	选项3	选项4
```

### 2. 更新题库到系统

将题库数据替换到HTML文件中的`examData`变量：

```javascript
const examData = `题型	题干	难度	答案	选项A	选项B	选项C	选项D	选项E
单选题	你的问题?		A	选项1	选项2	选项3	选项4
...你的题库数据...`;
```

### 3. 打开系统

直接用浏览器打开`考试系统.html`即可使用。

---

## 许可说明

本项目为内部使用项目，代码可自由修改和复用。

---

## 更新日志

### v1.0 (2025-01-10)
- ✅ 完成基础功能开发
- ✅ 支持4种题型
- ✅ 完整的答题、评分、错题分析功能
- ✅ 响应式界面设计

### 已知问题修复
- 修复判断题id命名不一致导致无法选中
- 修复点击选项重复触发导致状态反转
- 修复多选题空字符串判定为已答题
- 修复进度条滚动时不可见
- 优化整个选项区域点击体验

---

## 联系方式

如有问题或建议，请联系开发团队。
